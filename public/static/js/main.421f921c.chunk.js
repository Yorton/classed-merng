(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{272:function(e,t,n){e.exports=n(429)},278:function(e,t,n){},429:function(e,t,n){"use strict";n.r(t);var a=n(69),r=n.n(a);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=n(0),l=n.n(o),c=n(38),s=n(20),m=n(439),i=(n(277),n(278),n(18)),u=n(65),d=n(239),p=n.n(d),b={user:null};if(localStorage.getItem("jwtToken")){var E=p()(localStorage.getItem("jwtToken"));1e3*E.exp<Date.now()?localStorage.removeItem("jwtToken"):b.user=E}var g=localStorage.getItem("jwtToken");console.log("auth token",g);var f=Object(o.createContext)({user:null,login:function(e){},logout:function(){},headers:{Authorization:g?"Bearer ".concat(g):""}});function v(e,t){switch(t.type){case"LOGIN":return Object(u.a)(Object(u.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(u.a)(Object(u.a)({},e),{},{user:null});default:return e}}function h(e){var t=Object(o.useReducer)(v,{user:b}),n=Object(i.a)(t,2),a=n[0],r=n[1];return l.a.createElement(f.Provider,Object.assign({value:{user:a.user,login:function(e){localStorage.setItem("jwtToken",e.token),r({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),r({type:"LOGOUT"})}}},e))}var j=n(265);var O=function(e){var t=e.component,n=Object(j.a)(e,["component"]),a=Object(o.useContext)(f).user;return console.log("AuthRoute",a),l.a.createElement(s.b,Object.assign({},n,{render:function(e){return a?l.a.createElement(s.a,{to:"/"}):l.a.createElement(t,e)}}))},y=n(445);var C=function(){var e=Object(o.useContext)(f),t=e.user,n=e.logout,a=window.location.pathname,r="/"===a?"home":a.substr(1),s=Object(o.useState)(r),m=Object(i.a)(s,2),u=m[0],d=m[1],p=function(e,t){var n=t.name;return d(n)};return t?l.a.createElement(y.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},l.a.createElement(y.a.Item,{name:t.username,active:!0,as:c.b,to:"/"}),l.a.createElement(y.a.Menu,{position:"right"},l.a.createElement(y.a.Item,{name:"logout",onClick:n}))):l.a.createElement(y.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},l.a.createElement(y.a.Item,{name:"home",active:"home"===u,onClick:p,as:c.b,to:"/"}),l.a.createElement(y.a.Menu,{position:"right"},l.a.createElement(y.a.Item,{name:"login",active:"login"===u,onClick:p,as:c.b,to:"/login"}),l.a.createElement(y.a.Item,{name:"register",active:"register"===u,onClick:p,as:c.b,to:"/register"})))},w=n(27),I=n(447),k=n(443),P=n(448),S=n(261),$=n(444),x=n(85),N=n(138),A=n(101),D=n.n(A),L=n(29),M=n(19),Q=n.n(M),R=n(441);var T=function(e){var t=e.content,n=e.children;return l.a.createElement(R.a,{inverted:!0,content:t,trigger:n})};function U(){var e=Object(L.a)(["\n    mutation likePost($postId: ID!){\n        likePost(postId: $postId){\n            id\n            likes{\n                id\n                username\n            }\n            likeCount\n        }\n    }\n"]);return U=function(){return e},e}var z=Q()(U()),B=function(e){var t=e.user,n=e.post,a=n.id,r=n.likeCount,s=n.likes,m=Object(o.useState)(!1),u=Object(i.a)(m,2),d=u[0],p=u[1];Object(o.useEffect)((function(){t&&s.find((function(e){return e.username===t.username}))?p(!0):p(!1)}),[t,s]);var b=Object(w.useMutation)(z,{variables:{postId:a}}),E=Object(i.a)(b,1)[0],g=t?d?l.a.createElement($.a,{color:"teal"},l.a.createElement(x.a,{name:"heart"})):l.a.createElement($.a,{color:"teal",basic:!0},l.a.createElement(x.a,{name:"heart"})):l.a.createElement($.a,{as:c.b,to:"/login",color:"teal",basic:!0},l.a.createElement(x.a,{name:"heart"}));return l.a.createElement($.a,{as:"div",labelPosition:"right",onClick:E},l.a.createElement(T,{content:d?"Unlike":"Like"},g),l.a.createElement(N.a,{basic:!0,color:"teal",pointing:"left"},r))},q=n(442);function G(){var e=Object(L.a)(["\n{\n    getPosts{\n        id \n        body \n        createdAt \n        username \n        likeCount\n        likes{\n            username\n        }\n        commentCount\n        comments{\n            id \n            username \n            createdAt \n            body\n        }\n    }\n}    \n"]);return G=function(){return e},e}var H=Q()(G());function F(){var e=Object(L.a)(["\n    mutation deleteComment($postId: ID!, $commentId: ID!){\n        deleteComment(postId: $postId, commentId: $commentId){\n            id\n            comments{\n                id\n                username\n                createdAt\n                body\n            }\n            commentCount\n        }\n    }\n"]);return F=function(){return e},e}function J(){var e=Object(L.a)(["\n    mutation deletePost($postId: ID!){\n        deletePost(postId: $postId)\n      \n    }\n"]);return J=function(){return e},e}var V=Q()(J()),W=Q()(F()),K=function(e){var t=e.postId,n=e.commentId,a=e.callback,r=Object(o.useState)(!1),c=Object(i.a)(r,2),s=c[0],m=c[1],u=n?W:V,d=Object(w.useMutation)(u,{update:function(e){if(m(!1),!n){var r=e.readQuery({query:H});r.getPosts=r.getPosts.filter((function(e){return e.id!==t})),e.writeQuery({query:H,data:r})}a&&a()},variables:{postId:t,commentId:n}}),p=Object(i.a)(d,1)[0];return l.a.createElement(l.a.Fragment,null,l.a.createElement(T,{content:n?"Delete comment":"Delete post"},l.a.createElement($.a,{as:"div",color:"red",onClick:function(){return m(!0)},floated:"right"},l.a.createElement(x.a,{name:"trash",style:{margin:0}}))),l.a.createElement(q.a,{open:s,onCancel:function(){m(!1)},onConfirm:p}))};var X=function(e){var t=e.post,n=t.body,a=t.createdAt,r=t.id,s=t.username,m=t.likeCount,i=t.commentCount,u=t.likes,d=e.props,p=Object(o.useContext)(f).user;return l.a.createElement(P.a,{fluid:!0},l.a.createElement(P.a.Content,null,l.a.createElement(S.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),l.a.createElement(P.a.Header,null,s),l.a.createElement(P.a.Meta,{as:c.b,to:"/posts/".concat(r)},D()(a).fromNow(!0)),l.a.createElement(P.a.Description,null,n)),l.a.createElement(P.a.Content,{extra:!0},l.a.createElement(B,{user:p,post:{id:r,likes:u,likeCount:m}}),l.a.createElement(T,{content:"Comment on post"},l.a.createElement($.a,{labelPosition:"right",as:c.b,to:"/posts/".concat(r)},l.a.createElement($.a,{color:"blue",basic:!0},l.a.createElement(x.a,{name:"comments"})),l.a.createElement(N.a,{basic:!0,color:"blue",pointing:"left"},i))),p&&p.username===s&&l.a.createElement(K,{postId:r,callback:function(){d.history.push("/")}})))},Y=n(263),Z=n(440),_=n(127),ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(o.useState)(t),a=Object(i.a)(n,2),r=a[0],l=a[1],c=function(e){l(Object(u.a)(Object(u.a)({},r),{},Object(_.a)({},e.target.name,e.target.value)))},s=function(t){t.preventDefault(),e()};return{onChange:c,onSubmit:s,values:r}};function te(){var e=Object(L.a)(["\n    mutation createPost($body: String!){\n        createPost(body: $body){\n            id\n            body\n            createdAt\n            username\n            likes{\n                id\n                username\n                createdAt\n            }\n            likeCount\n            comments{\n                id\n                body\n                username\n                createdAt\n            }\n            commentCount\n        }\n    }\n"]);return te=function(){return e},e}var ne=Q()(te()),ae=function(e){var t=e.props,n=ee((function(){m()}),{body:""}),a=n.values,r=n.onChange,o=n.onSubmit,c=Object(w.useMutation)(ne,{update:function(e,n){var r=e.readQuery({query:H});r.getPosts=[n.data.createPost].concat(Object(Y.a)(r.getPosts)),e.writeQuery({query:H,data:r}),a.body="",t.history.push("/")},variables:a}),s=Object(i.a)(c,2),m=s[0],u=s[1].error;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Z.a,{onSubmit:o},l.a.createElement("h2",null,"Create a post:"),l.a.createElement(Z.a.Field,null,l.a.createElement(Z.a.Input,{placeholder:"Hi world",name:"body",onChange:r,value:a.body,error:!!u}),l.a.createElement($.a,{type:"submit",color:"teal"},"Submit"))),u&&l.a.createElement("div",{className:"ui error message",style:{marginBottom:20}},l.a.createElement("ul",{className:"list"},l.a.createElement("li",null,u.graphQLErrors[0].message))))};var re=function(e){var t=Object(o.useContext)(f).user,n=Object(w.useQuery)(H),a=n.loading,r=n.data;return console.log("home",r),l.a.createElement(I.a,{columns:3},l.a.createElement(I.a.Row,{className:"page-title"},l.a.createElement("h1",null,"Recent Posts")),l.a.createElement(I.a.Row,null,t&&l.a.createElement(I.a.Column,null,l.a.createElement(ae,{props:e})),a?l.a.createElement("h1",null,"Loading posts..."):l.a.createElement(k.a.Group,null,r&&r.getPosts&&r.getPosts.map((function(t){return l.a.createElement(I.a.Column,{key:t.id,style:{marginBottom:20}},l.a.createElement(X,{post:t,props:e}))})))))};function oe(){var e=Object(L.a)(["\n    mutation login(\n        $username: String!\n        $password: String!\n    ){\n        login(\n                username: $username\n                password: $password\n        ){\n            id\n            email\n            username\n            createdAt\n            token\n        }\n    }\n"]);return oe=function(){return e},e}var le=Q()(oe()),ce=function(e){var t=Object(o.useContext)(f),n=Object(o.useState)({}),a=Object(i.a)(n,2),r=a[0],c=a[1],s=ee((function(){E()}),{username:"",password:""}),m=s.onChange,u=s.onSubmit,d=s.values,p=Object(w.useMutation)(le,{update:function(n,a){console.log("login",a.data.login),t.login(a.data.login),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.errors)},variables:d}),b=Object(i.a)(p,2),E=b[0],g=b[1].loading;return l.a.createElement("div",{className:"form-container"},l.a.createElement("form",{onSubmit:u,noValidate:!0,className:g?"loading":""},l.a.createElement("h1",null,"Login page"),l.a.createElement(Z.a.Input,{label:"Username",placeholder:"Username...",name:"username",type:"text",value:d.username,error:!!r.username,onChange:m}),l.a.createElement(Z.a.Input,{label:"Password",placeholder:"Password...",name:"password",type:"password",value:d.password,error:!!r.password,onChange:m}),l.a.createElement("div",{className:"field"},l.a.createElement($.a,{type:"submit",primary:!0},"Login"))),Object.keys(r).length>0&&l.a.createElement("div",{className:"ui error message"},l.a.createElement("ul",{className:"list"},Object.values(r).map((function(e){return l.a.createElement("li",{key:e},e)})))))};function se(){var e=Object(L.a)(["\n    mutation register(\n        $username: String!\n        $email: String!\n        $password: String!\n        $confirmPassword: String!\n    ){\n        register(\n            registerInput: {\n                username: $username\n                email: $email\n                password: $password\n                confirmPassword: $confirmPassword\n            }\n        ){\n            id\n            email\n            username\n            createdAt\n            token\n        }\n    }\n"]);return se=function(){return e},e}var me=Q()(se()),ie=function(e){var t=Object(o.useContext)(f),n=Object(o.useState)({}),a=Object(i.a)(n,2),r=a[0],c=a[1],s=ee((function(){E()}),{username:"",email:"",password:"",confirmPassword:""}),m=s.onChange,u=s.onSubmit,d=s.values,p=Object(w.useMutation)(me,{update:function(n,a){var r=a.data.register;t.login(r),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.errors)},variables:d}),b=Object(i.a)(p,2),E=b[0],g=b[1].loading;return l.a.createElement("div",{className:"form-container"},l.a.createElement("form",{onSubmit:u,noValidate:!0,className:g?"loading":""},l.a.createElement("h1",null,"Register page"),l.a.createElement(Z.a.Input,{label:"Username",placeholder:"Username...",name:"username",type:"text",value:d.username,error:!!r.username,onChange:m}),l.a.createElement(Z.a.Input,{label:"Email",placeholder:"Email...",name:"email",type:"email",value:d.email,error:!!r.email,onChange:m}),l.a.createElement(Z.a.Input,{label:"Password",placeholder:"Password...",name:"password",type:"password",value:d.password,error:!!r.password,onChange:m}),l.a.createElement(Z.a.Input,{label:"Confirm Password",placeholder:"Confirm Password...",name:"confirmPassword",type:"password",value:d.confirmPassword,error:!!r.confirmPassword,onChange:m}),l.a.createElement("div",{className:"field"},l.a.createElement($.a,{type:"submit",primary:!0},"Register"))),Object.keys(r).length>0&&l.a.createElement("div",{className:"ui error message"},l.a.createElement("ul",{className:"list"},Object.values(r).map((function(e){return l.a.createElement("li",{key:e},e)})))))},ue=n(139);function de(){var e=Object(L.a)(["\n    query ($postId: ID!){\n        getPost(postId: $postId){\n            id\n            body\n            createdAt\n            username\n            likeCount\n            likes{\n                username\n            }\n            commentCount\n            comments{\n                id\n                body\n                createdAt\n                username\n            }\n        }\n    }\n"]);return de=function(){return e},e}function pe(){var e=Object(L.a)(["\n    mutation($postId: String!, $body: String!){\n        createComment(postId: $postId, body: $body){\n            id\n            comments{\n                id\n                body\n                createdAt\n                username\n            }\n            commentCount\n        }\n    }\n"]);return pe=function(){return e},e}var be=Q()(pe()),Ee=Q()(de()),ge=function(e){var t,n=e.match.params.postId,a=Object(o.useContext)(f).user,r=Object(o.useRef)(null),c=Object(o.useState)(""),s=Object(i.a)(c,2),m=s[0],u=s[1],d=Object(w.useQuery)(Ee,{variables:{postId:n}}).data,p=(d=void 0===d?{}:d).getPost,b=Object(w.useMutation)(be,{update:function(){u(""),r.current.blur()},variables:{postId:n,body:m}}),E=Object(i.a)(b,1)[0];if(p){var g=p.id,v=p.body,h=p.createdAt,j=p.username,O=p.comments,y=p.likes,C=p.commentCount,k=p.likeCount;t=l.a.createElement(I.a,{columns:3},l.a.createElement(I.a.Row,null,l.a.createElement(I.a.Column,{width:2},l.a.createElement(S.a,{floated:"right",size:"small",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"})),l.a.createElement(I.a.Column,{width:10},l.a.createElement(P.a,{fluid:!0},l.a.createElement(P.a.Content,null,l.a.createElement(P.a.Header,null,j),l.a.createElement(P.a.Meta,null,D()(h).fromNow()),l.a.createElement(P.a.Description,null,v)),l.a.createElement("hr",null),l.a.createElement(P.a.Content,{extra:!0},l.a.createElement(B,{user:a,post:{id:g,likeCount:k,likes:y}}),l.a.createElement(T,{content:"Comment on post"},l.a.createElement($.a,{as:"div",labelPosition:"right",onClick:function(){console.log("Comment on post")}},l.a.createElement($.a,{basic:!0,color:"blue"},l.a.createElement(x.a,{name:"comments"})),l.a.createElement(N.a,{basic:!0,color:"blue",pointing:"left"},C))),a&&a.username===j&&l.a.createElement(K,{postId:g,callback:function(){e.history.push("/")}}))),a&&l.a.createElement(P.a,{fluid:!0},l.a.createElement(ue.a,null,l.a.createElement("p",null,"Post a comment"),l.a.createElement(Z.a,null,l.a.createElement("div",{className:"ui action input fluid"},l.a.createElement("input",{type:"text",placeholder:"Comment...",name:"comment",value:m,onChange:function(e){return u(e.target.value)},ref:r}),l.a.createElement("button",{type:"submit",className:"ui button teal",disabled:""===m.trim(),onClick:E},"Submit"))))),O.map((function(e){return l.a.createElement(P.a,{fluid:!0,key:e.id},l.a.createElement(ue.a,null,a&&a.username===e.username&&l.a.createElement(K,{postId:g,commentId:e.id}),l.a.createElement(P.a.Header,null,e.username),l.a.createElement(P.a.Meta,null,D()(e.createdAt).fromNow()),l.a.createElement(P.a.Description,null,e.body)))})))))}else t=l.a.createElement("p",null,"Loading post...");return t};var fe=function(){return l.a.createElement(h,null,l.a.createElement(c.a,null,l.a.createElement(m.a,null,l.a.createElement(C,null),l.a.createElement(s.b,{exact:!0,path:"/",component:re}),l.a.createElement(O,{exact:!0,path:"/login",component:ce}),l.a.createElement(O,{exact:!0,path:"/register",component:ie}),l.a.createElement(s.b,{exact:!0,path:"/posts/:postId",component:ge}))))},ve=n(260),he=n(262),je=n(264),Oe=n(259),ye=Object(je.a)({uri:"/"}),Ce=(Object(Oe.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),new ve.a({link:ye,cache:new he.a})),we=l.a.createElement(w.ApolloProvider,{client:Ce},l.a.createElement(fe,null));r.a.render(we,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[272,1,2]]]);
//# sourceMappingURL=main.421f921c.chunk.js.map